<?xml version="1.0" encoding="utf-8" ?>
<configuration>

    <contextListener class="org.pharosnet.postgres.channel.config.log.LoggerStartupListener"/>

    <logger name="com.hazelcast" level="INFO" />
    <logger name="io.netty" level="WARN" />
    <logger name="io.vertx" level="WARN" />

    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <Pattern>[%highlight(%-5level)] [%yellow(%d{yyyy-MM-dd HH:mm:ss.SSS})] [%magenta(%20.20(%thread))] [%cyan(%40.40(%logger))] - %msg%n</Pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="ASYNC_TEXT" class="ch.qos.logback.classic.AsyncAppender">
        <appender-ref ref="CONSOLE"/>
        <discardingThreshold>0</discardingThreshold>
        <queueSize>1024</queueSize>
    </appender>

    <appender name="JSON" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
            <providers>
                <pattern>
                    <pattern>
                        { "application": "postgres channel" }
                    </pattern>
                </pattern>
                <timestamp>
                    <fieldName>timestamp</fieldName>
                    <pattern>yyyy-MM-dd'T'HH:mm:ss.SSS</pattern>
                </timestamp>
                <logLevel/>
                <arguments>
                    <fieldName>args</fieldName>
                </arguments>
                <message>
                    <fieldName>message</fieldName>
                    <messageSplitRegex>SYSTEM</messageSplitRegex>
                </message>
                <callerData/>
                <stackTrace/>
            </providers>
        </encoder>
    </appender>
    <appender name="ASYNC_JSON" class="ch.qos.logback.classic.AsyncAppender">
        <appender-ref ref="JSON"/>
        <discardingThreshold>0</discardingThreshold>
        <queueSize>1024</queueSize>
    </appender>

    <root level='${postgres-channel.logger.level}'>
        <if condition='property("LOGGER_FORMAT").equals("text")'>
            <then>
                <appender-ref ref="ASYNC_TEXT"/>
            </then>
        </if>
        <if condition='property("LOGGER_FORMAT").equals("json")'>
            <then>
                <appender-ref ref="ASYNC_JSON"/>
            </then>
        </if>
    </root>


</configuration>